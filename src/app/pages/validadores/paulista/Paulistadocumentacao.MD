# ğŸ¦ Validador CNAB 400 - Banco Paulista (611)

## ğŸ“‹ VisÃ£o Geral

Validador de arquivos de **Remessa** CNAB 400 para o Banco Paulista S.A. (cÃ³digo 611), especializado em Fundos de Investimentos de Direitos CreditÃ³rios (FIDC).

---

## ğŸ¯ EspecificaÃ§Ãµes do Arquivo

### Nomenclatura do Arquivo

```
Formato: CBDDMMxx.REM ou CBDDMMxx.TXT

Onde:
- CB    : Caracteres fixos
- DD    : Dia de geraÃ§Ã£o do arquivo
- MM    : MÃªs de geraÃ§Ã£o do arquivo
- xx    : VariÃ¡veis alfanumÃ©ricas (01, AE, E1, etc.)
- .REM  : ExtensÃ£o do arquivo
- .TXT  : ExtensÃ£o alternativa

Exemplos vÃ¡lidos:
âœ… CB230501.REM
âœ… CB2305AE.REM
âœ… CB2305E1.REM
âœ… CB230501.TXT
```

### ServiÃ§os Permitidos

O sistema CNAB 400 do Banco Paulista permite:
- âœ… Entrada de tÃ­tulos
- âœ… InstruÃ§Ãµes de cobranÃ§a

---

## ğŸ“Š Estrutura do Arquivo

### Tipos de Registro

| Tipo | Nome | Quantidade | DescriÃ§Ã£o |
|------|------|------------|-----------|
| **0** | Header | 1 | IdentificaÃ§Ã£o do arquivo e origem |
| **1** | Detalhe | 1 ou mais | Dados dos tÃ­tulos |
| **9** | Trailer | 1 | Encerramento do arquivo |

**Tamanho do registro**: 400 caracteres (fixo)

---

## ğŸ” Layout dos Registros

### ğŸ“Œ Registro Header (Tipo 0)

**15 campos** mapeados conforme especificaÃ§Ã£o oficial:

#### Campos Principais

| Campo | PosiÃ§Ãµes | Tamanho | Tipo | ConteÃºdo | ObrigatÃ³rio |
|-------|----------|---------|------|----------|-------------|
| Tipo Registro | 001-001 | 1 | N | `0` | âœ… Sim |
| Ident. Arquivo | 002-002 | 1 | N | `1` (Remessa) | âœ… Sim |
| Literal Remessa | 003-009 | 7 | A | `REMESSA` | âœ… Sim |
| CÃ³d. ServiÃ§o | 010-011 | 2 | N | `01` (CobranÃ§a) | âœ… Sim |
| Literal ServiÃ§o | 012-026 | 15 | A | `COBRANCA` | âœ… Sim |
| CÃ³d. Originador | 027-046 | 20 | N | Fornecido pelo banco | âœ… Sim |
| Nome Originador | 047-076 | 30 | A | RazÃ£o Social | âœ… Sim |
| NÂº Banco Paulista | 077-079 | 3 | N | `611` | âœ… Sim |
| Nome Banco | 080-094 | 15 | A | `PAULISTA S.A.` | âœ… Sim |
| Data GravaÃ§Ã£o | 095-100 | 6 | N | DDMMAA | âœ… Sim |
| Branco | 101-108 | 8 | A | Branco | âœ… Sim |
| Ident. Sistema | 109-110 | 2 | A | `MX` | âœ… Sim |
| NÂº Seq. Arquivo | 111-117 | 7 | N | Sequencial | âœ… Sim |
| Branco | 118-394 | 277 | A | Branco | âœ… Sim |
| Seq. Registro | 395-400 | 6 | N | `000001` | âœ… Sim |

**Total**: 400 caracteres

---

### ğŸ“Œ Registro Detalhe (Tipo 1)

**46 campos** mapeados para transaÃ§Ãµes de tÃ­tulos:

#### Campos Principais de IdentificaÃ§Ã£o

| Campo | PosiÃ§Ãµes | Tamanho | Tipo | DescriÃ§Ã£o |
|-------|----------|---------|------|-----------|
| Tipo Registro | 001-001 | 1 | N | `1` |
| NÂº Controle | 038-062 | 25 | A | NÃºmero de identificaÃ§Ã£o do tÃ­tulo |
| CÃ³d. OcorrÃªncia | 109-110 | 2 | N | Ver cÃ³digos de ocorrÃªncia |
| NÂº Documento | 111-120 | 10 | A | NÃºmero do documento |
| Vencimento | 121-126 | 6 | N | DDMMAA |
| Valor TÃ­tulo | 127-139 | 13 | N | Valor com 2 decimais |

#### CÃ³digos de OcorrÃªncia Suportados

| CÃ³digo | DescriÃ§Ã£o | ObservaÃ§Ã£o |
|--------|-----------|------------|
| **01** | Remessa | Entrada de tÃ­tulo |
| **04** | Abatimento | Mediante justificativa |
| **06** | AlteraÃ§Ã£o de vencimento | Para conciliaÃ§Ã£o |
| **14** | Pagamento Parcial | - |
| **71** | Baixa por Recompra Paulista | Com liquidaÃ§Ã£o consultoria |
| **72** | Recompra Parcial sem Adiantamento | - |
| **73** | Recompra Parcial com Adiantamento | - |
| **74** | Baixa por Recompra | Com liquidaÃ§Ã£o cedente |
| **75** | Baixa por DepÃ³sito Cedente | - |
| **76** | Baixa por DepÃ³sito Consultoria | - |
| **77** | Baixa por DepÃ³sito Sacado | - |
| **80** | Remessa Paulista | Com liquidaÃ§Ã£o consultoria |
| **81** | Entrada por Recompra | Troca de tÃ­tulos |
| **84** | Entrada por Recompra | Com liquidaÃ§Ã£o cedente |
| **87** | ReativaÃ§Ã£o | - |

#### EspÃ©cies de TÃ­tulo

| CÃ³digo | DescriÃ§Ã£o |
|--------|-----------|
| **01** | Duplicata |
| **02** | Nota PromissÃ³ria |
| **51** | Cheque |

#### Campos com ValidaÃ§Ã£o Especial

**Dados do Sacado**:
- Tipo InscriÃ§Ã£o (219-220): `01` (CPF) ou `02` (CNPJ)
- CPF/CNPJ (221-234): 14 posiÃ§Ãµes, alinhado Ã  direita
- Nome (235-274): 40 posiÃ§Ãµes
- EndereÃ§o (275-314): 40 posiÃ§Ãµes
- CEP (327-334): 8 posiÃ§Ãµes

**Campos ObrigatÃ³rios para Duplicata**:
- InscriÃ§Ã£o Estadual Sacado (160-173)
- NÂº Termo CessÃ£o (174-192)
- NÂº NF Duplicata (315-323)
- SÃ©rie NF (324-326)

**DecomposiÃ§Ã£o do Campo Cedente** (335-394):
- PosiÃ§Ãµes 335-380: Nome do Cedente (46 caracteres)
- PosiÃ§Ãµes 381-394: CNPJ do Cedente (14 caracteres)

---

### ğŸ“Œ Registro Trailer (Tipo 9)

**3 campos** simples:

| Campo | PosiÃ§Ãµes | Tamanho | ConteÃºdo |
|-------|----------|---------|----------|
| Tipo Registro | 001-001 | 1 | `9` |
| Branco | 002-394 | 393 | Branco |
| Seq. Registro | 395-400 | 6 | NÂº sequencial do Ãºltimo registro |

---

## âœ… Regras de ValidaÃ§Ã£o

### 1. Estrutura do Arquivo

- âœ… Deve iniciar com registro Header (Tipo 0)
- âœ… Deve conter pelo menos 1 registro Detalhe (Tipo 1)
- âœ… Deve terminar com registro Trailer (Tipo 9)
- âœ… Todas as linhas com exatamente 400 caracteres
- âœ… SequÃªncia numÃ©rica contÃ­nua (000001, 000002, 000003...)

### 2. Campos NumÃ©ricos

**Regra CrÃ­tica**: Campos numÃ©ricos devem ser alinhados **Ã  direita** com zeros Ã  esquerda.

```
âŒ ERRADO: "     12345" (espaÃ§os Ã  esquerda)
âœ… CORRETO: "0000012345" (zeros Ã  esquerda)
```

**Valores MonetÃ¡rios**: 2 casas decimais

```
Exemplo: Valor R$ 2.470,56
No arquivo: 000000000247056 (13 posiÃ§Ãµes)
```

### 3. Campos AlfanumÃ©ricos

- Alinhados **Ã  esquerda**
- Completados com espaÃ§os Ã  direita
- Sempre em MAIÃšSCULO
- Sem caracteres especiais (Ã‡, @, etc.)
- Sem acentos (Ã, Ã‰, ÃŠ, etc.)

```
âŒ ERRADO: "JosÃ© da Silva"
âœ… CORRETO: "JOSE DA SILVA                           "
```

### 4. Datas

Formato: **DDMMAA** (6 posiÃ§Ãµes)

```
Exemplo: 23 de maio de 2024
No arquivo: 230524
```

### 5. Valores Fixos ObrigatÃ³rios

| Campo | Valor |
|-------|-------|
| Literal Remessa | `REMESSA` |
| Literal ServiÃ§o | `COBRANCA` |
| CÃ³digo do Banco | `611` |
| Nome do Banco | `PAULISTA S.A.` |
| IdentificaÃ§Ã£o Sistema | `MX` |

---

## ğŸ§ª Casos de Teste

### âœ… Arquivo VÃ¡lido MÃ­nimo

```
Estrutura:
Linha 1: Header (Tipo 0) - Seq. 000001
Linha 2: Detalhe (Tipo 1) - Seq. 000002
Linha 3: Trailer (Tipo 9) - Seq. 000003
```

### âŒ Erros Comuns

#### Erro 1: CÃ³digo do Banco Incorreto
```
PosiÃ§Ã£o 077-079: "237" â† ERRADO (cÃ³digo do Bradesco)
PosiÃ§Ã£o 077-079: "611" â† CORRETO (cÃ³digo do Paulista)
```

#### Erro 2: Literal com EspaÃ§os
```
PosiÃ§Ã£o 003-009: "REMESSA " â† ERRADO (7 caracteres, mas com espaÃ§o no final)
PosiÃ§Ã£o 003-009: "REMESSA" â† CORRETO (preencher Ã  esquerda)
```

#### Erro 3: Campo NumÃ©rico com EspaÃ§os
```
PosiÃ§Ã£o 127-139: "     247056  " â† ERRADO
PosiÃ§Ã£o 127-139: "0000000247056" â† CORRETO
```

#### Erro 4: Data InvÃ¡lida
```
PosiÃ§Ã£o 095-100: "320524" â† ERRADO (dia 32 nÃ£o existe)
PosiÃ§Ã£o 095-100: "230524" â† CORRETO (23/05/24)
```

#### Erro 5: SequÃªncia Quebrada
```
Linha 1: 000001 (Header)
Linha 2: 000002 (Detalhe)
Linha 3: 000005 (Trailer) â† ERRADO (deveria ser 000003)
```

---

## ğŸ“Š Matriz de ValidaÃ§Ã£o

| ValidaÃ§Ã£o | Tipo | AÃ§Ã£o |
|-----------|------|------|
| Tamanho linha â‰  400 | ğŸš« Erro | Bloqueia processamento |
| Tipo registro invÃ¡lido | ğŸš« Erro | Bloqueia processamento |
| Campo obrigatÃ³rio vazio | ğŸš« Erro | Bloqueia processamento |
| Campo numÃ©rico com espaÃ§os | ğŸš« Erro | Bloqueia processamento |
| Valor fixo incorreto | ğŸš« Erro | Bloqueia processamento |
| SequÃªncia quebrada | ğŸš« Erro | Bloqueia processamento |
| Data invÃ¡lida | ğŸš« Erro | Bloqueia processamento |
| MÃºltiplos headers | âš ï¸ Aviso | Permite processamento |

---

## ğŸ¨ Interface do Validador

### Recursos Visuais

1. **Upload de Arquivo**
   - Ãrea de arrastar e soltar
   - Aceita .REM e .TXT
   - Feedback visual ao hover

2. **EstatÃ­sticas do Arquivo**
   - Cards coloridos por tipo de registro
   - Contador total de linhas
   - IdentificaÃ§Ã£o visual de tipos

3. **RelatÃ³rio de Erros**
   - SeparaÃ§Ã£o visual: Erros CrÃ­ticos vs Avisos
   - Lista scrollÃ¡vel com detalhes
   - IndicaÃ§Ã£o de linha e campo com erro

4. **Legenda Interativa**
   - Campos clicÃ¡veis
   - Destaque na visualizaÃ§Ã£o
   - Tooltips com descriÃ§Ãµes

5. **VisualizaÃ§Ã£o Matriz**
   - Cada caractere em cÃ©lula individual
   - Cores por tipo de campo
   - Bordas vermelhas para erros

---

## ğŸ’¡ Dicas de Uso

### Para Desenvolvedores

1. **GeraÃ§Ã£o de Arquivos**
   ```typescript
   // Sempre preencher campos numÃ©ricos com zeros Ã  esquerda
   const valorFormatado = valor.toString().padStart(13, '0');

   // Sempre preencher campos alfanumÃ©ricos Ã  esquerda
   const nomeFormatado = nome.padEnd(40, ' ').substring(0, 40);

   // Sempre converter para maiÃºsculas sem acentos
   const textoFormatado = removerAcentos(texto.toUpperCase());
   ```

2. **ValidaÃ§Ã£o de Datas**
   ```typescript
   const validarData = (ddmmaa: string): boolean => {
     const dia = parseInt(ddmmaa.substring(0, 2));
     const mes = parseInt(ddmmaa.substring(2, 4));
     return dia >= 1 && dia <= 31 && mes >= 1 && mes <= 12;
   };
   ```

3. **CÃ¡lculo de SequÃªncia**
   ```typescript
   let sequencial = 1;
   linhas.forEach(linha => {
     linha.setSequencial(sequencial.toString().padStart(6, '0'));
     sequencial++;
   });
   ```

### Para UsuÃ¡rios

1. **Antes de Enviar**
   - âœ… Validar o arquivo no sistema
   - âœ… Verificar se nÃ£o hÃ¡ erros crÃ­ticos
   - âœ… Conferir totais e quantidades
   - âœ… Validar nomenclatura do arquivo

2. **Em Caso de Erro**
   - ğŸ“ Anotar o nÃºmero da linha com erro
   - ğŸ“ Verificar o campo especÃ­fico indicado
   - ğŸ“ Corrigir o valor conforme mensagem
   - ğŸ“ Re-validar apÃ³s correÃ§Ã£o

---

## ğŸ“ ReferÃªncias

- **Banco**: Banco Paulista S.A.
- **CÃ³digo**: 611
- **Sistema**: FIDC (Fundos de Investimentos de Direitos CreditÃ³rios)
- **PadrÃ£o**: CNAB 400
- **Tipo**: Remessa
- **Website**: www.fromtis.com.br

---

## âœ… Checklist de Conformidade

- [x] Header (Tipo 0): 15 campos mapeados
- [x] Detalhe (Tipo 1): 46 campos mapeados
- [x] Trailer (Tipo 9): 3 campos mapeados
- [x] ValidaÃ§Ã£o de campos numÃ©ricos rigorosa
- [x] ValidaÃ§Ã£o de sequÃªncia de registros
- [x] ValidaÃ§Ã£o de estrutura do arquivo
- [x] Suporte a datas DDMMAA
- [x] Sistema de severidade (erro/aviso)
- [x] Interface visual moderna
- [x] Encoding ISO-8859-1

---

**VersÃ£o**: 1.0
**Data**: 2024-01-24
**Conformidade**: CNAB 400 Banco Paulista (EspecificaÃ§Ã£o Oficial)
