# Validador CNAB 400 - Banco BMP Money Plus

## ğŸ“‹ Resumo das Melhorias

Este validador foi completamente revisado para seguir fielmente a documentaÃ§Ã£o oficial do layout CNAB 400 do Banco BMP Money Plus.

## ğŸ¯ Principais MudanÃ§as

### 1. **Layouts Completos e Precisos**

#### Header (Tipo 0) - 400 bytes
- âœ… 15 campos mapeados conforme documentaÃ§Ã£o
- âœ… ValidaÃ§Ã£o de literal "REMESSA" (posiÃ§Ãµes 3-9)
- âœ… ValidaÃ§Ã£o de literal "COBRANCA" (posiÃ§Ãµes 12-26)
- âœ… ValidaÃ§Ã£o do nÃºmero do banco BMP: 274 (posiÃ§Ãµes 77-79)
- âœ… ValidaÃ§Ã£o de identificaÃ§Ã£o do sistema: "MX" (posiÃ§Ãµes 109-110)
- âœ… Sequencial do registro deve ser 000001

#### Detalhe (Tipo 1) - 400 bytes
- âœ… 44 campos mapeados conforme documentaÃ§Ã£o
- âœ… ValidaÃ§Ã£o completa de Nosso NÃºmero (11 dÃ­gitos + dÃ­gito verificador)
- âœ… ValidaÃ§Ã£o de Campo de Multa (0=sem multa, 2=com multa)
- âœ… ValidaÃ§Ã£o de CondiÃ§Ã£o de EmissÃ£o: 2=Cliente emite boleto
- âœ… ValidaÃ§Ã£o de IdentificaÃ§Ã£o de OcorrÃªncia (01, 02, 06, 07, 20)
- âœ… ValidaÃ§Ã£o de EspÃ©cie de TÃ­tulo (01-32, 99)
- âœ… ValidaÃ§Ã£o de Tipo de InscriÃ§Ã£o Pagador (01=CPF, 02=CNPJ)
- âœ… ValidaÃ§Ã£o de Tipo Sacador Avalista (0-9)

#### Tipo 2 (Registro Opcional) - 400 bytes
- âœ… 11 campos para mensagens complementares
- âœ… 4 campos de mensagens de 80 caracteres cada
- âœ… Campos de endereÃ§o complementar (nÃºmero, bairro, UF, cidade)
- âš ï¸ **Nota**: Sequencial deve seguir o tipo 1 anterior

#### Tipo 3 (Registro Opcional) - 400 bytes
- âœ… 10 campos para descontos mÃºltiplos
- âœ… Tipo de desconto (1=Fixo, 2=Percentual, 3=AntecipaÃ§Ã£o Dia, 5=%AntecipaÃ§Ã£o)
- âœ… 3 conjuntos de data + valor de desconto
- âš ï¸ **Nota**: Sequencial deve seguir o tipo 2 anterior

#### Trailer (Tipo 9) - 400 bytes
- âœ… 3 campos conforme documentaÃ§Ã£o
- âœ… Sequencial deve ser o Ãºltimo nÃºmero da sequÃªncia

### 2. **ValidaÃ§Ãµes Implementadas**

#### ValidaÃ§Ãµes de Estrutura:
- âœ… Arquivo deve ter exatamente 400 caracteres por linha
- âœ… Deve conter pelo menos 1 Header (Tipo 0)
- âœ… Deve conter pelo menos 1 Trailer (Tipo 9)
- âš ï¸ Aviso se nÃ£o houver registros Tipo 1 (Detalhe)
- âš ï¸ Aviso se houver mais de 1 Header

#### ValidaÃ§Ãµes de Campo:
- âœ… Campos obrigatÃ³rios nÃ£o podem estar vazios
- âœ… Campos numÃ©ricos devem conter apenas dÃ­gitos (0-9)
- âœ… Campos numÃ©ricos NÃƒO podem ter espaÃ§os (devem usar zeros Ã  esquerda)
- âœ… ValidaÃ§Ã£o de valores permitidos (quando aplicÃ¡vel)
- âœ… ValidaÃ§Ã£o de formato de data DDMMAA:
  - Dia entre 01-31
  - MÃªs entre 01-12
- âœ… ValidaÃ§Ã£o de sequÃªncia numÃ©rica dos registros

### 3. **EstatÃ­sticas do Arquivo**

O validador agora exibe estatÃ­sticas detalhadas:
- Total de linhas
- Quantidade de Headers (Tipo 0)
- Quantidade de Detalhes (Tipo 1)
- Quantidade de registros Tipo 2 (Mensagens)
- Quantidade de registros Tipo 3 (Descontos)
- Quantidade de Trailers (Tipo 9)
- Quantidade de tipos desconhecidos

### 4. **VisualizaÃ§Ã£o Aprimorada**

#### Matriz Visual:
- âœ… Fonte monoespaÃ§ada (Courier New) para alinhamento perfeito
- âœ… 400 cÃ©lulas por linha
- âœ… Largura fixa de 13px por cÃ©lula
- âœ… Cores distintas por campo
- âœ… EspaÃ§os visualizados como ponto mÃ©dio (Â·)
- âœ… CÃ©lulas com erro destacadas em vermelho com animaÃ§Ã£o
- âœ… Sistema de seleÃ§Ã£o de campo (clique na legenda)
- âœ… Hover effect para inspeÃ§Ã£o individual

#### Cores por Tipo de Registro:
- **Header (0)**: Roxo (#7b1fa2)
- **Detalhe (1)**: Verde (#388e3c)
- **Tipo 2**: Laranja (#f57c00)
- **Tipo 3**: Verde-Ã¡gua (#00695c)
- **Trailer (9)**: Rosa (#c2185b)

### 5. **Sistema de Erros e Avisos**

#### Erros CrÃ­ticos (ğŸš«):
- Tipo de registro desconhecido
- Tamanho de linha incorreto
- Campos obrigatÃ³rios vazios
- Campos numÃ©ricos com espaÃ§os ou caracteres invÃ¡lidos
- Valores fora do conjunto permitido
- Datas invÃ¡lidas
- SequÃªncia incorreta de registros
- Estrutura de arquivo incorreta

#### Avisos (âš ï¸):
- Arquivo sem registros de Detalhe
- MÃºltiplos Headers no arquivo

### 6. **ReferÃªncias da DocumentaÃ§Ã£o**

O cÃ³digo segue precisamente as seguintes seÃ§Ãµes da documentaÃ§Ã£o:

1. **Registro Header Label** (pÃ¡ginas 7-12):
   - PosiÃ§Ãµes 1-400
   - 15 campos definidos
   - ValidaÃ§Ãµes especÃ­ficas de literais e cÃ³digos

2. **Registro de TransaÃ§Ã£o - Tipo 1** (pÃ¡ginas 8-18):
   - PosiÃ§Ãµes 1-400
   - 44 campos definidos
   - ValidaÃ§Ãµes de identificaÃ§Ã£o da empresa beneficiÃ¡ria
   - CÃ¡lculo do dÃ­gito do Nosso NÃºmero (mÃ³dulo 11, base 7)
   - InstruÃ§Ãµes de cobranÃ§a
   - EspÃ©cies de tÃ­tulo (32 tipos + outros)

3. **Registro de TransaÃ§Ã£o - Tipo 2** (pÃ¡gina 11):
   - Registro opcional
   - Mensagens complementares
   - EndereÃ§o detalhado do pagador
   - Regras de sequencial

4. **Registro de TransaÃ§Ã£o - Tipo 3** (pÃ¡gina 12):
   - Registro opcional
   - Descontos mÃºltiplos
   - Tipos de desconto
   - Regras de sequencial

5. **Registro Trailer** (pÃ¡gina 12):
   - PosiÃ§Ãµes 1-400
   - Sequencial final

## ğŸ“Š Casos de Uso

### ValidaÃ§Ã£o BÃ¡sica
1. Anexe arquivo .REM ou .TXT
2. O sistema valida automaticamente
3. Veja estatÃ­sticas, erros e avisos
4. Inspecione visualmente a matriz colorida

### InspeÃ§Ã£o Detalhada
1. Clique em qualquer campo na legenda
2. Todos os campos desse tipo serÃ£o destacados
3. Os demais campos ficam esmaecidos
4. Clique novamente para desmarcar

### IdentificaÃ§Ã£o de Erros
1. Erros aparecem com borda vermelha na matriz
2. Lista completa de erros com linha, campo e mensagem
3. Contador de erros por linha no cabeÃ§alho

## ğŸ¨ Responsividade

O CSS adapta automaticamente para diferentes tamanhos de tela:

- **Desktop**: CÃ©lulas 13x18px, fonte 11px
- **Tablet** (â‰¤768px): CÃ©lulas 11x16px, fonte 10px
- **Mobile** (â‰¤480px): CÃ©lulas 9x14px, fonte 9px

## ğŸ–¨ï¸ ImpressÃ£o

Estilos especiais para impressÃ£o:
- Evita quebra de pÃ¡gina no meio de um registro
- Bordas visÃ­veis em escala de cinza
- Erros destacados em rosa claro

## ğŸ“ Notas Importantes

1. **Encoding**: O arquivo Ã© lido com ISO-8859-1 para compatibilidade com sistemas bancÃ¡rios
2. **Tamanho**: Cada linha DEVE ter exatamente 400 caracteres
3. **SequÃªncia**: Os registros devem estar em ordem sequencial crescente (000001, 000002, etc.)
4. **Tipos Opcionais**: Registros Tipo 2 e 3 sÃ£o opcionais, mas quando presentes devem seguir as regras de sequencial
5. **Nosso NÃºmero**: O dÃ­gito verificador Ã© calculado com mÃ³dulo 11, base 7 (incluindo o nÃºmero da carteira)

## ğŸ”§ Tecnologias

- Angular 17+ (Standalone Component)
- TypeScript
- DomSanitizer para HTML seguro
- CommonModule para diretivas

## ğŸš€ PrÃ³ximas Melhorias Sugeridas

- [ ] Exportar relatÃ³rio de validaÃ§Ã£o em PDF
- [ ] ValidaÃ§Ã£o do dÃ­gito verificador do Nosso NÃºmero
- [ ] Suporte para upload de mÃºltiplos arquivos
- [ ] ComparaÃ§Ã£o entre arquivos (diff)
- [ ] Gerador de arquivo CNAB 400 vÃ¡lido
- [ ] ValidaÃ§Ã£o de CPF/CNPJ
- [ ] ValidaÃ§Ã£o de cÃ³digo de barras
- [ ] Exportar/importar configuraÃ§Ãµes de validaÃ§Ã£o

## ğŸ“„ LicenÃ§a

Este validador foi desenvolvido com base na documentaÃ§Ã£o oficial do Banco BMP Money Plus para fins educacionais e de conformidade.
