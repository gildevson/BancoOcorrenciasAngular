<div class="cnab-validador">
  <h2 class="titulo">ğŸ¦ Validador Retorno Banco BMP CNAB 400</h2>

  <div class="upload-area">
    <label class="upload-label">ğŸ“ Selecione o arquivo de retorno (.RET ou .TXT)</label>
    <input type="file" accept=".ret,.txt,.RET,.TXT" (change)="onFileChange($event)" />
  </div>

  <div *ngIf="error" class="erro-container">
    âŒ {{ error }}
  </div>

  <!-- EstatÃ­sticas -->
  <div *ngIf="estatisticas && validado" class="estatisticas-grid">
    <div class="stat-card stat-total">
      <div class="stat-valor">{{ estatisticas.totalLinhas }}</div>
      <div class="stat-label">Total Linhas</div>
    </div>
    <div class="stat-card stat-header">
      <div class="stat-valor">{{ estatisticas.headers }}</div>
      <div class="stat-label">Headers (0)</div>
    </div>
    <div class="stat-card stat-detalhe">
      <div class="stat-valor">{{ estatisticas.detalhes }}</div>
      <div class="stat-label">Detalhes (1)</div>
    </div>
    <div class="stat-card stat-trailer">
      <div class="stat-valor">{{ estatisticas.trailers }}</div>
      <div class="stat-label">Trailers (9)</div>
    </div>
  </div>

  <!-- Erros CrÃ­ticos -->
  <div *ngIf="getErrosPorSeveridade('erro').length > 0" class="erros-container erros-criticos">
    <strong>ğŸš« {{ getErrosPorSeveridade('erro').length }} erro(s) crÃ­tico(s):</strong>
    <ul>
      <li *ngFor="let e of getErrosPorSeveridade('erro')">
        <strong class="erro-linha">Linha {{ e.linha }}</strong> -
        <span class="erro-campo">{{ e.campo }}</span>
        <span class="erro-posicao">[{{ e.posicao }}]</span>:
        <code class="erro-valor">{{ e.valor }}</code>
        â†’ <span class="erro-msg">{{ e.mensagem }}</span>
      </li>
    </ul>
  </div>

  <!-- Avisos -->
  <div *ngIf="getErrosPorSeveridade('aviso').length > 0" class="erros-container erros-avisos">
    <strong>âš ï¸ {{ getErrosPorSeveridade('aviso').length }} aviso(s):</strong>
    <ul>
      <li *ngFor="let e of getErrosPorSeveridade('aviso')">
        <strong>Linha {{ e.linha }}</strong> - {{ e.campo }}: {{ e.mensagem }}
      </li>
    </ul>
  </div>

  <!-- Sucesso -->
  <div *ngIf="validado && getErrosPorSeveridade('erro').length === 0" class="sucesso-container">
    <strong>âœ… Arquivo vÃ¡lido!</strong>
    <span *ngIf="getErrosPorSeveridade('aviso').length > 0" class="avisos-count">
      ({{ getErrosPorSeveridade('aviso').length }} aviso(s))
    </span>
  </div>

  <!-- Legenda -->
  <div *ngIf="legendaCampos.length > 0" class="legenda-container">
    <strong>ğŸ“Œ Clique em um campo para destacar:</strong>
    <div class="legenda-campos">
      <span *ngFor="let campo of legendaCampos"
            (click)="selecionarCampo(campo.nome)"
            class="legenda-item"
            [class.selecionado]="campoSelecionado === campo.nome"
            [style.background]="campo.cor"
            [title]="campo.descricao || 'Clique para destacar'">
        {{ campo.nome }} <span class="legenda-pos">[{{ campo.ini + 1 }}-{{ campo.fim }}]</span>
      </span>
    </div>
    <div *ngIf="campoSelecionado" class="campo-selecionado-info">
      <strong>Campo selecionado:</strong> {{ campoSelecionado }}
      <button (click)="selecionarCampo(campoSelecionado!)">Limpar seleÃ§Ã£o</button>
    </div>
  </div>

  <!-- VisualizaÃ§Ã£o da Matriz -->
  <div *ngIf="visualHtml" class="matriz-container" [innerHTML]="visualHtml"></div>

  <!-- Placeholder -->
  <div *ngIf="!visualHtml && !error" class="placeholder">
    <div class="placeholder-icon">ğŸ“„</div>
    <div class="placeholder-text">Nenhum arquivo carregado</div>
    <div class="placeholder-hint">Selecione um arquivo .RET (Retorno CNAB 400 - Banco BMP) para iniciar a validaÃ§Ã£o</div>
  </div>
</div>
