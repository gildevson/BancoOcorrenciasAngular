<header class="b3-header-container" role="banner" [class.scrolled]="isScrolled">
  <div class="header-content">
    <!-- Logo -->
    <div class="b3-logo">
      <a routerLink="/" (click)="closeMenu()" class="b3-logo-link"
        aria-label="Banco Ocorrência - Ir para página inicial">
        <img class="b3-logo-icon" src="assets/logo/logoBo.png" alt="Logo BO - Banco Ocorrência" loading="eager" />
        <span class="b3-logo-text">
          Banco <strong>Ocorrência</strong>
        </span>
      </a>
    </div>

    <!-- Navegação Principal -->
    <nav id="navigation-menu" class="b3-nav-main" [class.open]="menuOpen" role="navigation"
      aria-label="Navegação principal" [attr.aria-hidden]="isMobile && !menuOpen" (click)="onMenuClick($event)">
      <!-- Botão fechar (apenas mobile) -->
      <button *ngIf="isMobile && menuOpen" class="mobile-close" type="button" (click)="closeMenu()"
        aria-label="Fechar menu de navegação">
        <span class="material-icons" aria-hidden="true">close</span>
      </button>

      <ul class="b3-nav-menu">
        <!-- Login Mobile -->
        <li class="mobile-login-item" *ngIf="isMobile">
          <a [routerLink]="[{ outlets: { modal: ['login'] } }]" title="Login Administrativo"
            aria-label="Fazer login como administrador">
            <span class="material-icons" aria-hidden="true">account_circle</span>
          </a>
        </li>

        <!-- Início -->
        <li routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" #rlaHome="routerLinkActive">
          <a routerLink="/" (click)="closeMenu()" aria-label="Ir para página inicial"
            [attr.aria-current]="rlaHome.isActive ? 'page' : null">
            Início
          </a>
        </li>

        <!-- Consultar Ocorrências -->
        <li routerLinkActive="active" #rlaOc="routerLinkActive">
          <a routerLink="/ocorrencia" (click)="closeMenu()" aria-label="Consultar ocorrências bancárias"
            [attr.aria-current]="rlaOc.isActive ? 'page' : null">
            Ocorrências
          </a>
        </li>

        <li routerLinkActive="active" #rlaCalc="routerLinkActive">
          <a routerLink="/calculadora" (click)="closeMenu()" aria-label="Calculadora financeira"
            [attr.aria-current]="rlaCalc.isActive ? 'page' : null">
            Calculadora Lista
          </a>
        </li>

        <!-- Validadores -->


        <!-- Layouts -->
        <li routerLinkActive="active" #rlaLay="routerLinkActive">
          <a routerLink="/layouts" (click)="closeMenu()" aria-label="Ver layouts CNAB"
            [attr.aria-current]="rlaLay.isActive ? 'page' : null">
            Layouts
          </a>
        </li>

        <!-- Notícias -->
        <li routerLinkActive="active" #rlaNot="routerLinkActive">
          <a routerLink="/noticias" (click)="closeMenu()" aria-label="Ver notícias do sistema bancário"
            [attr.aria-current]="rlaNot.isActive ? 'page' : null">
            Notícias
          </a>
        </li>

        <!-- Dropdown: Relatórios
        <li class="dropdown" [class.active]="dropdownOpen === 'reports'">
          <button class="dropdown-trigger" type="button" (click)="toggleDropdown('reports')"
            [attr.aria-expanded]="dropdownOpen === 'reports'" aria-haspopup="true" aria-controls="reports-menu"
            aria-label="Menu de relatórios - expandir para ver opções">
            Relatórios
            <i class="dropdown-arrow" aria-hidden="true"></i>
          </button>

          <ul class="dropdown-menu" id="reports-menu" role="menu" [attr.aria-hidden]="dropdownOpen !== 'reports'">
            <li role="none">
              <a routerLink="/relatorio-vendas" (click)="closeMenu()" role="menuitem">Vendas</a>
            </li>
            <li role="none">
              <a routerLink="/relatorio-clientes" (click)="closeMenu()" role="menuitem">Clientes</a>
            </li>
            <li role="none">
              <a routerLink="/relatorio-financeiro" (click)="closeMenu()" role="menuitem">Financeiro</a>
            </li>
          </ul>
        </li>

        -->

      </ul>
    </nav>

    <!-- Controles da Direita -->
    <div class="b3-controls">
      <!-- Login Desktop -->
      <ng-container *ngIf="!isMobile">
        <ng-container *ngIf="user$ | async as u; else loginDesktop">
          <div class="user-area">
            <span class="material-icons" aria-hidden="true">account_circle</span>
            <span class="user-name">Olá, <strong>{{ u.nome }}</strong></span>

            <button type="button" class="logout-btn" (click)="logout()">
              Sair
            </button>
          </div>
        </ng-container>

        <ng-template #loginDesktop>
          <div class="login-icon">
            <a [routerLink]="[{ outlets: { modal: ['login'] } }]" title="Login Administrativo"
              aria-label="Fazer login como administrador" (click)="closeMenu()">
              <span class="material-icons" aria-hidden="true">account_circle</span>
            </a>
          </div>
        </ng-template>
      </ng-container>

      <!-- NOVO: Ícone Organizar Ocorrências -->
      <!--   <div class="b3-icons organize-icon">
        <button type="button" (click)="onOrganizeClick()" aria-label="Organizar ocorrências"
          title="Organizar Ocorrências" [class.active]="organizePanelOpen">
          <span class="material-icons" aria-hidden="true">sort</span>
          <span class="sr-only">Organizar ocorrências</span>
        </button>
      </div>
-->
      <!-- Busca -->
      <div class="b3-icons">
        <button type="button" (click)="onSearchClick()" aria-label="Abrir busca de ocorrências"
          [class.loading]="searchLoading" [disabled]="searchLoading">
          <span class="material-icons" aria-hidden="true">
            {{ searchLoading ? 'hourglass_empty' : 'search' }}
          </span>
          <span class="sr-only">Buscar ocorrências</span>
        </button>
      </div>

      <!-- Menu Mobile -->
      <button class="menu-toggle" type="button" (click)="toggleMenu()" [attr.aria-expanded]="menuOpen"
        [attr.aria-controls]="'navigation-menu'"
        [attr.aria-label]="menuOpen ? 'Fechar menu principal' : 'Abrir menu principal'">
        <span class="material-icons" aria-hidden="true">
          {{ menuOpen ? 'close' : 'menu' }}
        </span>
      </button>
    </div>
  </div>

  <!-- Backdrop Mobile -->
  <div class="backdrop" *ngIf="menuOpen && isMobile" [class.active]="menuOpen && isMobile" (click)="onBackdropClick()"
    role="presentation" aria-hidden="true"></div>
  <!-- Sub-navegação (ADMIN ONLY) -->
  <!-- Sub-navegação (ADMIN ONLY) -->
  <nav class="b3-nav-sub" role="navigation" aria-label="Navegação de categorias"
    *ngIf="(isAdmin$ | async) || (isSupervisor$ | async)">

    <div class="sub-nav-scroll-container" (scroll)="onSubNavScroll($event)">

      <!-- ✅ SE for SUPERVISOR (e não ADMIN), mostra só Edições -->
      <ng-container *ngIf="onlyEdicoes$ | async; else adminNav">
        <ul>
          <li routerLinkActive="active">
            <a routerLink="/edicoes-ocorrencias" (click)="closeMenu()">
              EDITAR OCORRÊNCIAS
            </a>
          </li>
        </ul>
      </ng-container>

      <!-- ✅ SE for ADMIN, mostra tudo -->
      <ng-template #adminNav>
        <ul>
          <li [class.active]="activeSubNav === 'processamento'">
            <a href="#" (click)="onSubNavClick($event, 'processamento')">PROCESSAMENTO</a>
          </li>

          <li [class.active]="activeSubNav === 'cadastros'">
            <a href="#" (click)="onSubNavClick($event, 'cadastros')">CADASTROS</a>
          </li>

          <li [class.active]="activeSubNav === 'auditoria'">
            <a href="#" (click)="onSubNavClick($event, 'auditoria')">AUDITORIA</a>
          </li>

          <li [class.active]="activeSubNav === 'relatorios'">
            <a href="#" (click)="onSubNavClick($event, 'relatorios')">RELATÓRIOS</a>
          </li>

          <li [class.active]="activeSubNav === 'configuracoes'">
            <a href="#" (click)="onSubNavClick($event, 'configuracoes')">CONFIGURAÇÕES</a>
          </li>

          <!-- ✅ Editar Ocorrências com mesmo estilo -->
          <li routerLinkActive="active">
            <a routerLink="/edicoes-ocorrencias" (click)="closeMenu()">
              EDITAR OCORRÊNCIAS
            </a>
          </li>
        </ul>
      </ng-template>

    </div>
  </nav>



</header>
