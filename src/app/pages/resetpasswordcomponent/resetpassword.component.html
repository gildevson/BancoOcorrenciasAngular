<section class="reset-shell">
  <div class="reset-card" role="region" aria-label="Área de redefinição de senha">

    <!-- ✅ SPINNER NO CARD -->
    <div class="loading-overlay-card" *ngIf="loading()">
      <div class="loading-content">
        <div class="spinner-box">
          <div class="spinner-main"></div>
          <div class="spinner-ring"></div>
        </div>
        <p>Redefinindo senha...</p>
        <span class="loading-sub">Por favor, aguarde</span>
      </div>
    </div>

    <!-- HEADER -->
    <header class="reset-head">
      <div class="brand">
        <img class="brand-logo" src="assets/logo/logoBo.png" alt="Banco Ocorrência" />
        <div class="brand-text">
          <div class="brand-title">Banco <strong>Ocorrência</strong></div>
          <div class="brand-sub">Redefinição de senha</div>
        </div>
      </div>
    </header>

    <!-- BODY -->
    <div class="reset-body">
      <h1>Nova Senha</h1>
      <p class="hint">Crie uma senha forte com no mínimo 6 caracteres.</p>

      <!-- ALERTA DE SUCESSO -->
      <div class="alert success" *ngIf="successMsg() as msg" role="alert">
        <span class="material-icons" aria-hidden="true">check_circle</span>
        <span>{{ msg }}</span>
      </div>

      <!-- ALERTA DE ERRO -->
      <div class="alert error" *ngIf="errorMsg() as msg" role="alert">
        <span class="material-icons" aria-hidden="true">error_outline</span>
        <span>{{ msg }}</span>
      </div>

      <!-- FORMULÁRIO -->
      <form [formGroup]="form" (ngSubmit)="submit()" novalidate>

        <!-- NOVA SENHA -->
        <div class="field" [class.invalid]="hasError('novaSenha')">
          <label for="novaSenha">Nova Senha</label>
          <div class="control">
            <span class="material-icons" aria-hidden="true">lock</span>
            <input
              id="novaSenha"
              [type]="showPassword() ? 'text' : 'password'"
              autocomplete="new-password"
              formControlName="novaSenha"
              placeholder="••••••••"
              aria-describedby="novaSenhaHelp"
            />
            <button
              type="button"
              class="icon-btn"
              (click)="togglePassword()"
              [attr.aria-label]="showPassword() ? 'Ocultar senha' : 'Mostrar senha'"
            >
              <span class="material-icons" aria-hidden="true">
                {{ showPassword() ? 'visibility_off' : 'visibility' }}
              </span>
            </button>
          </div>
          <small id="novaSenhaHelp" class="help" *ngIf="hasError('novaSenha')">
            A senha deve ter no mínimo 6 caracteres.
          </small>
        </div>

        <!-- CONFIRMAR SENHA -->
        <div class="field" [class.invalid]="hasError('confirmarSenha') || hasPasswordMismatch()">
          <label for="confirmarSenha">Confirmar Senha</label>
          <div class="control">
            <span class="material-icons" aria-hidden="true">lock</span>
            <input
              id="confirmarSenha"
              [type]="showConfirmPassword() ? 'text' : 'password'"
              autocomplete="new-password"
              formControlName="confirmarSenha"
              placeholder="••••••••"
              aria-describedby="confirmarSenhaHelp"
            />
            <button
              type="button"
              class="icon-btn"
              (click)="toggleConfirmPassword()"
              [attr.aria-label]="showConfirmPassword() ? 'Ocultar senha' : 'Mostrar senha'"
            >
              <span class="material-icons" aria-hidden="true">
                {{ showConfirmPassword() ? 'visibility_off' : 'visibility' }}
              </span>
            </button>
          </div>
          <small id="confirmarSenhaHelp" class="help" *ngIf="hasPasswordMismatch()">
            As senhas não coincidem.
          </small>
        </div>

        <!-- BOTÃO REDEFINIR -->
        <button class="primary" type="submit" [disabled]="loading() || !!successMsg()">
          <span class="btn-content">
            <ng-container *ngIf="loading(); else iconReset">
              <span class="btn-spinner" aria-hidden="true"></span>
              <span>Redefinindo...</span>
            </ng-container>
            <ng-template #iconReset>
              <span class="material-icons" aria-hidden="true">check</span>
              <span>Redefinir Senha</span>
            </ng-template>
          </span>
        </button>

        <!-- RODAPÉ -->
        <div class="foot">
          <button type="button" class="back" (click)="goToLogin()">
            <span class="material-icons" aria-hidden="true">arrow_back</span>
            Voltar para o login
          </button>
        </div>

      </form>
    </div>

  </div>
</section>
