<div class="bancos-layout">
  <!-- CARD DO GRÁFICO -->
  <section class="chart-card">
    <div class="chart-head">
      <div class="title">
        <div class="label">Câmbio</div>
        <div class="ticker">{{ selectedSymbol }} • {{ activePeriod }}</div>
      </div>

      <div class="periods" aria-label="Períodos do gráfico">
        <button
          type="button"
          *ngFor="let p of periodKeys"
          (click)="setPeriod(p)"
          [class.active]="activePeriod === p">
          {{ p }}
        </button>
      </div>
    </div>

    <!-- ✅ CONVERSOR MELHORADO -->
    <div class="converter">
      <div class="converter-header">
        <span class="material-icons">swap_horiz</span>
        <span>Conversor de Moedas</span>
      </div>

      <div class="converter-body">
        <!-- Moeda de Origem -->
        <div class="currency-input">
          <select
            [(ngModel)]="fromCurrency"
            (change)="onFromCurrencyChange()"
            class="currency-select">
            <option *ngFor="let curr of availableCurrencies" [value]="curr.code">
              {{ curr.code }} - {{ curr.name }}
            </option>
          </select>
          <input
            type="number"
            [(ngModel)]="amountFrom"
            (input)="onAmountChange()"
            min="0"
            step="0.01"
            class="amount-input"
            placeholder="0.00">
        </div>

        <!-- Botão de Trocar -->
        <button
          type="button"
          class="swap-btn"
          (click)="swapCurrencies()"
          title="Trocar moedas">
          <span class="material-icons">swap_vert</span>
        </button>

        <!-- Moeda de Destino -->
        <div class="currency-input">
          <select
            [(ngModel)]="toCurrency"
            (change)="onToCurrencyChange()"
            class="currency-select">
            <option *ngFor="let curr of availableCurrencies" [value]="curr.code">
              {{ curr.code }} - {{ curr.name }}
            </option>
          </select>
          <input
            type="text"
            [value]="amountTo | number:'1.2-2'"
            class="amount-input result"
            readonly>
        </div>
      </div>

      <!-- Taxa de Conversão -->
      <div class="conversion-rate" *ngIf="conversionRate > 0">
        <span class="material-icons">info</span>
        1 {{ fromCurrency }} = {{ conversionRate | number:'1.4-4' }} {{ toCurrency }}
      </div>

      <!-- Loading -->
      <div class="conversion-loading" *ngIf="conversionLoading">
        <div class="mini-spinner"></div>
        Convertendo...
      </div>
    </div>

    <!-- Área do gráfico -->
    <div class="chart-body">
      <div class="loading" *ngIf="chartLoading">
        <div class="spinner"></div>
        <span>Carregando...</span>
      </div>

      <div class="chart-msg error" *ngIf="chartError && !chartLoading">
        <span class="material-icons">error_outline</span>
        {{ chartError }}
      </div>

      <canvas
        *ngIf="!chartLoading && !chartError"
        baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="lineChartType">
      </canvas>
    </div>
  </section>

  <!-- CARD DA LISTA -->
  <aside class="list-card">
    <div class="tabs" aria-label="Filtros da lista">
      <button type="button" (click)="setTab('principais')" [class.active]="activeTab==='principais'">Principais</button>
      <button type="button" (click)="setTab('altas')" [class.active]="activeTab==='altas'">Maiores Altas</button>
      <button type="button" (click)="setTab('baixas')" [class.active]="activeTab==='baixas'">Maiores Baixas</button>
    </div>

    <div class="search-box">
      <span class="material-icons search-icon">search</span>
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por código..."
        [(ngModel)]="searchTerm">
      <button
        type="button"
        class="clear-btn"
        *ngIf="searchTerm"
        (click)="clearSearch()">
        <span class="material-icons">close</span>
      </button>
    </div>

    <div class="hint">Clique em uma moeda para trocar o ativo do gráfico.</div>

    <div class="list" *ngIf="listaAtual?.length; else empty">
      <button
        type="button"
        class="row"
        *ngFor="let item of listaAtual"
        (click)="setSymbol(item.symbol)"
        [class.active]="item.symbol === selectedSymbol">

        <div class="left">
          <div class="meta">
            <div class="sym">{{ item.symbol }}</div>
            <div class="name">{{ item.shortName || item.longName }}</div>
          </div>
        </div>

        <div class="right">
          <div class="price">{{ fmtPrice(item.regularMarketPrice) }}</div>
          <div class="pct" [class.pos]="isPos(item)" [class.neg]="!isPos(item)">
            {{ fmtPct(item.regularMarketChangePercent) }}
          </div>
        </div>
      </button>
    </div>

    <ng-template #empty>
      <div class="empty-state">
        <span class="material-icons">{{ searchTerm ? 'search_off' : 'info' }}</span>
        <p>{{ searchTerm ? 'Nenhum resultado encontrado' : 'Sem dados para mostrar' }}</p>
      </div>
    </ng-template>
  </aside>
</div>
