<div class="bancos-layout">
  <!-- CARD DO GRÁFICO -->
  <section class="chart-card">
    <div class="chart-head">
      <div class="title">
        <div class="label">Setor Bancário</div>
        <div class="ticker">{{ selectedTicker }} • {{ activePeriod }}</div>
      </div>

      <div class="periods" aria-label="Períodos do gráfico">
        <button
          type="button"
          *ngFor="let p of periodKeys"
          (click)="setPeriod(p)"
          [class.active]="activePeriod === p">
          {{ p }}
        </button>
      </div>
    </div>

    <div class="chart-body">
      <div class="loading" *ngIf="chartLoading">
        <div class="spinner"></div>
        <span>Carregando...</span>
      </div>

      <div class="chart-msg" *ngIf="chartError && !chartLoading">
        {{ chartError }}
      </div>

      <canvas
        baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="lineChartType">
      </canvas>
    </div>
  </section>

  <!-- CARD DA LISTA -->
  <aside class="list-card">
    <div class="tabs" aria-label="Filtros da lista">
      <button type="button" (click)="setTab('negociados')" [class.active]="activeTab==='negociados'">Mais Negociados</button>
      <button type="button" (click)="setTab('altas')" [class.active]="activeTab==='altas'">Maiores Altas</button>
      <button type="button" (click)="setTab('baixas')" [class.active]="activeTab==='baixas'">Maiores Baixas</button>
    </div>

    <div class="search-box">
      <span class="material-icons search-icon">search</span>
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por código ou nome..."
        [(ngModel)]="searchTerm"
        aria-label="Buscar banco">
      <button
        type="button"
        class="clear-btn"
        *ngIf="searchTerm"
        (click)="clearSearch()"
        aria-label="Limpar busca">
        <span class="material-icons">close</span>
      </button>
    </div>

    <div class="hint">Clique em um banco para trocar o ativo do gráfico.</div>

    <div class="list" *ngIf="listaAtual?.length; else empty">
      <button
        type="button"
        class="row"
        *ngFor="let item of listaAtual; trackBy: trackBySymbol"
        (click)="setTicker(item.symbol)"
        [class.active]="item.symbol === selectedTicker">

        <div class="left">
          <img class="logo" [src]="logoUrl(item.symbol)" (error)="onLogoError($event)" alt="" />

          <div class="meta">
            <div class="sym">{{ item.symbol }}</div>
            <div class="name">{{ item.shortName || item.longName }}</div>
          </div>
        </div>

        <div class="right">
          <div class="price">{{ fmtPrice(item.regularMarketPrice) }}</div>

          <div class="volume" *ngIf="item.regularMarketVolume">
            Vol: {{ fmtVolume(item.regularMarketVolume) }}
          </div>

          <div class="pct" [class.pos]="isPos(item)" [class.neg]="!isPos(item)">
            {{ fmtPct(item.regularMarketChangePercent) }}
          </div>
        </div>
      </button>
    </div>

    <ng-template #empty>
      <div class="empty-state">
        <span class="material-icons">{{ searchTerm ? 'search_off' : 'info' }}</span>
        <p>{{ searchTerm ? 'Nenhum resultado encontrado' : 'Sem dados para mostrar' }}</p>
      </div>
    </ng-template>
  </aside>
</div>
